
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>An inferential problem: The Gender Wage Gap &#8212; My book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'group1_lab1_python';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multicollinearity" href="group1_lab2_python.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">An inferential problem: The Gender Wage Gap</a></li>


<li class="toctree-l1"><a class="reference internal" href="group1_lab2_python.html">Multicollinearity</a></li>

<li class="toctree-l1"><a class="reference internal" href="group1_lab3_python.html">Proving Neyman Orthogonality</a></li>







<li class="toctree-l1"><a class="reference internal" href="group1_lab4_python.html">WORKGROUP 4</a></li>

<li class="toctree-l1"><a class="reference internal" href="group1_lab5_python.html">Non-Linear Methods DML</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fgroup1_lab1_python.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/group1_lab1_python.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>An inferential problem: The Gender Wage Gap</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">An inferential problem: The Gender Wage Gap</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ols-regression-with-controls">Ols regression with controls</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialling-out-using-ols">Partialling-Out using ols</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-will-construct-a-prediction-rule-for-log-hourly-wage-y-which-depends-linearly-on-job-relevant-characteristics-x">Now, we will construct a prediction rule for (log) hourly wage <strong>Y</strong>, which depends linearly on job-relevant characteristics <strong>X</strong>:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting-out-of-sample-performance">Data Splitting: Out-of-sample performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#frisch-waugh-lovell-fwl-theorem-proof"><strong>1.Frisch-Waugh-Lovell (FWL) Theorem Proof</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objective"><strong>Objective</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proof"><strong>Proof</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-control-for-variables-in-w"><strong>Step 1: Control for Variables in <span class="math notranslate nohighlight">\(W\)</span></strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-estimate-psi"><strong>Step 2: Estimate <span class="math notranslate nohighlight">\(\Psi\)</span></strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-expectation-function-minimizes-expected-squared-error-proof"><strong>2.Conditional Expectation Function Minimizes Expected Squared Error Proof</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement"><strong>Problem Statement</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Objective</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Proof</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-expanding-the-expected-squared-error"><strong>Step 1: Expanding the Expected Squared Error</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-simplifying-using-the-law-of-iterated-expectations"><strong>Step 2: Simplifying Using the Law of Iterated Expectations</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-final-reduction"><strong>Step 3: Final Reduction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion"><strong>Conclusion</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="an-inferential-problem-the-gender-wage-gap">
<h1>An inferential problem: The Gender Wage Gap<a class="headerlink" href="#an-inferential-problem-the-gender-wage-gap" title="Link to this heading">#</a></h1>
<section id="data-analysis">
<h2>Data analysis<a class="headerlink" href="#data-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyreadr</span> <span class="k">as</span> <span class="nn">rr</span> <span class="c1"># package to use data form R format</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install pyreadr==0.4.2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#rdata_read = pyreadr.read_r(&quot;../../data/wage2015_subsample_inference.Rdata&quot;)</span>

<span class="n">data</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:/Users/Frank/Downloads/wage2015_subsample_inference.csv&#39;</span><span class="p">)</span>

<span class="c1"># Extracting the data frame from rdata_read</span>
<span class="c1">#data = rdata_read[ &#39;data&#39; ]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;occ&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">occ</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;occ2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">occ2</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;ind&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ind</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;ind2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ind2</span><span class="p">)</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#rdata_read = pyreadr.read_r(&quot;../../data/wage2015_subsample_inference.Rdata&quot;)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">data</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:/Users/Frank/Downloads/wage2015_subsample_inference.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Extracting the data frame from rdata_read</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1">#data = rdata_read[ &#39;data&#39; ]</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;occ&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">occ</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:948,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">944</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">945</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">948</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:611,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">611</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:1448,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1445</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1447</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1448</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\parsers\readers.py:1705,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1703</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1704</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1705</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1706</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1707</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1708</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1709</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1710</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1711</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1712</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1713</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1714</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1715</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1716</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\anaconda3\Lib\site-packages\pandas\io\common.py:863,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">863</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;C:/Users/Frank/Downloads/wage2015_subsample_inference.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Variable description</strong></em></p>
<ul class="simple">
<li><p>occ : occupational classification</p></li>
<li><p>ind : industry classification</p></li>
<li><p>lwage : log hourly wage</p></li>
<li><p>sex : gender (1 female) (0 male)</p></li>
<li><p>shs : some high school</p></li>
<li><p>hsg : High school graduated</p></li>
<li><p>scl : Some College</p></li>
<li><p>clg: College Graduate</p></li>
<li><p>ad: Advanced Degree</p></li>
<li><p>ne: Northeast</p></li>
<li><p>mw: Midwest</p></li>
<li><p>so: South</p></li>
<li><p>we: West</p></li>
<li><p>exp1: experience</p></li>
</ul>
<p>In this case, we Focus on the subset of college-advanced-educated workers. he analysis should be analogous to what we’ve presented – explaining basic, control and partialling out model, generating point estimates and standard errors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">scl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ad</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">clg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>To start our (causal) analysis, we compare the sample means given gender:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span><span class="s2">&quot;shs&quot;</span><span class="p">,</span><span class="s2">&quot;hsg&quot;</span><span class="p">,</span><span class="s2">&quot;scl&quot;</span><span class="p">,</span><span class="s2">&quot;clg&quot;</span><span class="p">,</span><span class="s2">&quot;ad&quot;</span><span class="p">,</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span><span class="s2">&quot;mw&quot;</span><span class="p">,</span><span class="s2">&quot;so&quot;</span><span class="p">,</span><span class="s2">&quot;we&quot;</span><span class="p">,</span><span class="s2">&quot;exp1&quot;</span><span class="p">]</span> <span class="p">]</span>

<span class="n">data_female</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span> <span class="s1">&#39;sex&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">]</span>
<span class="n">Z_female</span> <span class="o">=</span> <span class="n">data_female</span><span class="p">[</span> <span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span><span class="s2">&quot;shs&quot;</span><span class="p">,</span><span class="s2">&quot;hsg&quot;</span><span class="p">,</span><span class="s2">&quot;scl&quot;</span><span class="p">,</span><span class="s2">&quot;clg&quot;</span><span class="p">,</span><span class="s2">&quot;ad&quot;</span><span class="p">,</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span><span class="s2">&quot;mw&quot;</span><span class="p">,</span><span class="s2">&quot;so&quot;</span><span class="p">,</span><span class="s2">&quot;we&quot;</span><span class="p">,</span><span class="s2">&quot;exp1&quot;</span><span class="p">]</span> <span class="p">]</span>

<span class="n">data_male</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">data</span><span class="p">[</span> <span class="s1">&#39;sex&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">]</span>
<span class="n">Z_male</span> <span class="o">=</span> <span class="n">data_male</span><span class="p">[</span> <span class="p">[</span> <span class="s2">&quot;lwage&quot;</span><span class="p">,</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span><span class="s2">&quot;shs&quot;</span><span class="p">,</span><span class="s2">&quot;hsg&quot;</span><span class="p">,</span><span class="s2">&quot;scl&quot;</span><span class="p">,</span><span class="s2">&quot;clg&quot;</span><span class="p">,</span><span class="s2">&quot;ad&quot;</span><span class="p">,</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span><span class="s2">&quot;mw&quot;</span><span class="p">,</span><span class="s2">&quot;so&quot;</span><span class="p">,</span><span class="s2">&quot;we&quot;</span><span class="p">,</span><span class="s2">&quot;exp1&quot;</span> <span class="p">]</span> <span class="p">]</span>


<span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
<span class="n">table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">table</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z_male</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z_female</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">table_pandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">table</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="s1">&#39;Men&#39;</span><span class="p">,</span> <span class="s1">&#39;Women&#39;</span><span class="p">])</span> <span class="c1"># from table to dataframe</span>
<span class="n">table_pandas</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Log Wage&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Some High School&quot;</span><span class="p">,</span><span class="s2">&quot;High School Graduate&quot;</span><span class="p">,</span><span class="s2">&quot;Some College&quot;</span><span class="p">,</span><span class="s2">&quot;Gollage Graduate&quot;</span><span class="p">,</span><span class="s2">&quot;Advanced Degree&quot;</span><span class="p">,</span> <span class="s2">&quot;Northeast&quot;</span><span class="p">,</span><span class="s2">&quot;Midwest&quot;</span><span class="p">,</span><span class="s2">&quot;South&quot;</span><span class="p">,</span><span class="s2">&quot;West&quot;</span><span class="p">,</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span>
<span class="n">table_html</span> <span class="o">=</span> <span class="n">table_pandas</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span> <span class="c1"># html format</span>

<span class="n">table_pandas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="n">table_html</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In particular, the table above shows that the difference in average logwage between men and women is equal to  0,075</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_female</span><span class="p">[</span><span class="s1">&#39;lwage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">-</span> <span class="n">data_male</span><span class="p">[</span><span class="s1">&#39;lwage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Thus, the unconditional gender wage gap is about 7.5% for the group of never married workers (women get paid less on average in our sample). We also observe that never married working women are relatively more educated than working men and have lower working experience.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdata_read</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">read_r</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;../../../data/wage2015_subsample_inference.Rdata&quot;</span><span class="p">)</span>

<span class="n">xx</span>
<span class="c1"># Extracting the data frame from rdata_read</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rdata_read</span><span class="p">[</span> <span class="s1">&#39;data&#39;</span> <span class="p">]</span>


<span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>This unconditional (predictive) effect of gender equals the coefficient <span class="math notranslate nohighlight">\(\beta\)</span> in the univariate ols regression of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\(D\)</span>:</p>
<p>\begin{align}
\log(Y) &amp;=\beta D + \epsilon.
\end{align}</p>
<p>We verify this by running an ols regression in R.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">statsmodels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nocontrol_model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span> <span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">)</span>
<span class="n">nocontrol_est</span> <span class="o">=</span> <span class="n">nocontrol_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Coef.&#39;</span><span class="p">][</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span>
<span class="n">nocontrol_est</span>
<span class="n">nocontrol_se2</span> <span class="o">=</span> <span class="n">nocontrol_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Std.Err.&#39;</span><span class="p">][</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span>


<span class="c1"># robust standar erros</span>
<span class="n">HCV_coefs</span> <span class="o">=</span> <span class="n">nocontrol_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">cov_HC0</span>
<span class="n">nocontrol_se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">HCV_coefs</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> <span class="p">,</span> <span class="mf">0.5</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nocontrol_se</span>

<span class="c1"># print unconditional effect of gender and the corresponding standard error</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;The estimated gender coefficient is </span><span class="si">{</span><span class="n">nocontrol_est</span><span class="si">}</span><span class="s1"> and the corresponding standard error is </span><span class="si">{</span><span class="n">nocontrol_se2</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;The estimated gender coefficient is </span><span class="si">{</span><span class="n">nocontrol_est</span><span class="si">}</span><span class="s1"> and the corresponding robust standard error is </span><span class="si">{</span><span class="n">nocontrol_se</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>


<span class="c1"># confidence interval</span>
<span class="n">nocontrol_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span> <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;sex&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the standard error is computed with the <em>R</em> package <em>sandwich</em> to be robust to heteroskedasticity.</p>
<p>Next, we run an ols regression of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\((D,W)\)</span> to control for the effect of covariates summarized in <span class="math notranslate nohighlight">\(W\)</span>:</p>
<p>\begin{align}
\log(Y) &amp;=\beta_1 D  + \beta_2’ W + \epsilon.
\end{align}</p>
<p>Here, we are considering the flexible model from the previous lab. Hence, <span class="math notranslate nohighlight">\(W\)</span> controls for experience, education, region, and occupation and industry indicators plus transformations and two-way interactions.</p>
<p>Let us run the ols regression with controls.</p>
</section>
<section id="ols-regression-with-controls">
<h2>Ols regression with controls<a class="headerlink" href="#ols-regression-with-controls" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flex</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>

<span class="c1"># The smf api replicates R script when it transform data</span>
<span class="n">control_model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">flex</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">)</span>
<span class="n">control_est</span> <span class="o">=</span> <span class="n">control_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Coef.&#39;</span><span class="p">][</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">control_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">HCV_coefs</span> <span class="o">=</span> <span class="n">control_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">cov_HC0</span>
<span class="n">control_se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">HCV_coefs</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> <span class="p">,</span> <span class="mf">0.5</span><span class="p">)[</span><span class="mi">42</span><span class="p">]</span>  <span class="c1"># error standard for sex&#39;s coefficients </span>

<span class="n">control_se</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Coefficient for OLS with controls </span><span class="si">{</span><span class="n">control_est</span><span class="si">}</span><span class="s2"> and the corresponding robust standard error is </span><span class="si">{</span><span class="n">control_se</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>

<span class="c1"># confidence interval</span>
<span class="n">control_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span> <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;sex&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">control_model</span> 
</pre></div>
</div>
</div>
</div>
<p>The estimated regression coefficient  𝛽1≈−0.0676 measures how our linear prediction of wage changes if we set the gender variable  𝐷 from 0 to 1, holding the controls  𝑊 fixed. We can call this the predictive effect (PE), as it measures the impact of a variable on the prediction we make. Overall, we see that the unconditional wage gap of size  8 % for women decreases to about  7</p>
<p>Next, we are using the Frisch-Waugh-Lovell theorem from the lecture partialling-out the linear effect of the controls via ols.</p>
</section>
<section id="partialling-out-using-ols">
<h2>Partialling-Out using ols<a class="headerlink" href="#partialling-out-using-ols" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># models</span>
<span class="c1"># model for Y</span>
<span class="n">flex_y</span> <span class="o">=</span> <span class="s1">&#39;lwage ~  (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>
<span class="c1"># model for D</span>
<span class="n">flex_d</span> <span class="o">=</span> <span class="s1">&#39;sex ~ (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span> 

<span class="c1"># partialling-out the linear effect of W from Y</span>
<span class="n">t_Y</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">flex_y</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># partialling-out the linear effect of W from D</span>
<span class="n">t_D</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">flex_d</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">resid</span>


<span class="n">data_res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span> <span class="n">t_Y</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="n">t_D</span><span class="o">.</span><span class="n">values</span> <span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;t_Y&#39;</span><span class="p">,</span> <span class="s1">&#39;t_D&#39;</span> <span class="p">]</span> <span class="p">)</span>


<span class="c1"># regression of Y on D after partialling-out the effect of W</span>
<span class="n">partial_fit</span> <span class="o">=</span>  <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span> <span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;t_Y ~ t_D&#39;</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data_res</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">partial_est</span> <span class="o">=</span> <span class="n">partial_fit</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Coef.&#39;</span><span class="p">][</span><span class="s1">&#39;t_D&#39;</span><span class="p">]</span>


<span class="c1"># standard error</span>
<span class="n">HCV_coefs</span> <span class="o">=</span> <span class="n">partial_fit</span><span class="o">.</span><span class="n">cov_HC0</span>
<span class="n">partial_se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">HCV_coefs</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> <span class="p">,</span> <span class="mf">0.5</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Coefficient for D via partialling-out </span><span class="si">{</span><span class="n">partial_est</span><span class="si">}</span><span class="s2"> and the corresponding robust standard error is </span><span class="si">{</span><span class="n">partial_se</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>

<span class="c1"># confidence interval</span>
<span class="n">partial_fit</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span> <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;t_D&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#np.vstack(( t_Y.values , t_D.values )).T</span>

<span class="n">data_res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span> <span class="n">t_Y</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="n">t_D</span><span class="o">.</span><span class="n">values</span> <span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;t_Y&#39;</span><span class="p">,</span> <span class="s1">&#39;t_D&#39;</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">data_res</span>
</pre></div>
</div>
</div>
</div>
<p>Again, the estimated coefficient measures the linear predictive effect (PE) of <span class="math notranslate nohighlight">\(D\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> after taking out the linear effect of <span class="math notranslate nohighlight">\(W\)</span> on both of these variables. This coefficient equals the estimated coefficient from the ols regression with controls.</p>
<p>We know that the partialling-out approach works well when the dimension of <span class="math notranslate nohighlight">\(W\)</span> is low
in relation to the sample size <span class="math notranslate nohighlight">\(n\)</span>. When the dimension of <span class="math notranslate nohighlight">\(W\)</span> is relatively high, we need to use variable selection
or penalization for regularization purposes.</p>
<p>Use appropiate plots (i.e hist, barplots, scatter plots , pie plots, etc) to describe main varaibles (wage, log-wage, sex, some college, college graduate, avdanced degree, Experience)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">box</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span> <span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="s1">&#39;pastel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sexo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Logaritmo del salario por hora&#39;</span><span class="p">)</span>

<span class="c1"># The real wage quartiles are increasing with the educational level.</span>
<span class="c1"># Lower salary dispersion for the postgraduate level. pastel</span>
</pre></div>
</div>
</div>
</div>
<p>El promedio del logaritmo del salario es mayor para los hombres que para las mujeres</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Salario por hora&#39;</span><span class="p">)</span>

<span class="n">txt</span><span class="o">=</span><span class="s2">&quot;Elaboración propia&quot;</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>El salario por hora mas frecuente es el de 20 y hay una distribucion con cola a la izquierda. El salario mas alto es el de 130.</p>
<p>Para las mujeres,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;exp1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span> <span class="n">x_bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#A mas anos de experiencia, las personas consiguen un mayor salario.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">gridobj</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;exp1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span> 
                     <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> 
                     <span class="n">height</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> 
                     <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                     <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span> 
                     <span class="n">col</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span>
                     <span class="n">scatter_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

<span class="n">gridobj</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>A simple vista, se ve que la experiencia impacta positivamente en el salario. Pero, en las mujeres ese efecto es menor que en los hombres debido a las brechas de genero persistentes en el mercado laboral.</p>
<p>Plot the confidence Interval of sex’s coefficient for a different models (basic, control, and partially out). All three coefficients must be in one figure. Explain what you find.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">nocontrol_est</span><span class="p">,</span> <span class="n">control_est</span><span class="p">,</span> <span class="n">partial_est</span><span class="p">],</span>
    <span class="s1">&#39;err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">nocontrol_se2</span><span class="p">,</span> <span class="n">control_se</span><span class="p">,</span> <span class="n">partial_se</span><span class="p">],</span>
    <span class="s1">&#39;varname&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;No control&#39;</span><span class="p">,</span> <span class="s1">&#39;Con controles&#39;</span><span class="p">,</span> <span class="s1">&#39;Parcialmente fuera&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Reorganizar las columnas</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="p">[[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="s1">&#39;varname&#39;</span><span class="p">]]</span>

<span class="c1"># Mostrar el dataframe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coef_df</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">coef_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;varname&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> 
             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> 
             <span class="n">yerr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coef_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> 
           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> 
           <span class="n">y</span><span class="o">=</span><span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;No control&#39;</span><span class="p">,</span> <span class="s1">&#39;Con controles&#39;</span><span class="p">,</span> <span class="s1">&#39;Parcialmente fuera&#39;</span><span class="p">],</span> 
                       <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Los coeficientes son mayores para los modelos de Con controles y parcialmente fuera, cuando se restringe la muestra para las personas con educacion avanzada. Asimismo, el error se minimiza cuandos ewe usan los dos ultimos mnodelos, por lo que el intervalo de confianza es menor.</p>
<p>You will also include a replication of the next figure for both groups, female and male.You will have only two plotted lines (Actual/Predicted(fitted)) for these College-educated workers. You have to create two separate figures, one for female and one for male. Could you explain the different patterns that you find?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In[ ]:</span>





<span class="c1"># Los patrones que se encuentran son que los salarios son mayores para las personas que asisten a la universidad que de los que asisten solo a la secundaria. Luego, la relacion de los anos de experiencia en el salario solo es positiva, tanto para universidad y secundaria, hasta antes de que se llegue a los 35 anos de experiencia.</span>


<span class="n">data_hsg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;hsg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data_clg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data_scl</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;scl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">data_clgm</span> <span class="o">=</span> <span class="n">data_clg</span><span class="p">[</span><span class="n">data_clg</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Hombres</span>
<span class="n">data_clgf</span> <span class="o">=</span> <span class="n">data_clg</span><span class="p">[</span><span class="n">data_clg</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Mujeres</span>



<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Tabla_hsg</span>
<span class="n">Tabla_hsg</span> <span class="o">=</span> <span class="n">data_hsg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Promlwageo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lwage&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">nivel_hsg</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_hsg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">Promedio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nivel</span> <span class="ow">in</span> <span class="n">nivel_hsg</span><span class="p">:</span>
    <span class="n">Promedio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_hsg</span><span class="p">[</span><span class="n">data_hsg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nivel</span><span class="p">][</span><span class="s1">&#39;lwage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">Tabla_hsg</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tabla_hsg</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Tabla_clg</span>
<span class="n">Tabla_clg</span> <span class="o">=</span> <span class="n">data_clg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Promlwageo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lwage&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">Tabla_clgm</span> <span class="o">=</span> <span class="n">data_clg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Promlwageo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lwage&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">Tabla_clgf</span> <span class="o">=</span> <span class="n">data_clg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Promlwageo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lwage&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">nivel_clg</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_clg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">nivel_clgm</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_clgm</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">nivel_clgf</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_clgf</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">Promedio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nivel</span> <span class="ow">in</span> <span class="n">nivel_clg</span><span class="p">:</span>
    <span class="n">Promedio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_clg</span><span class="p">[</span><span class="n">data_clg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nivel</span><span class="p">][</span><span class="s1">&#39;lwage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">Tabla_clg</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="n">Tabla_clgm</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="n">Tabla_clgf</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tabla_clg</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Definir la fórmula del modelo</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>

<span class="c1"># Ajustar el modelo</span>
<span class="n">control_fit1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Hacer predicciones</span>
<span class="n">predict</span> <span class="o">=</span> <span class="n">control_fit1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Añadir las predicciones al DataFrame original</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict</span>

<span class="c1"># Filtrar datos para scl y clg</span>
<span class="n">data_sclP</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;scl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data_clgP</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data_hsgP</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;hsg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">data_clgPm</span> <span class="o">=</span> <span class="n">data_clgP</span><span class="p">[</span><span class="n">data_clgP</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Hombres</span>
<span class="n">data_clgPf</span> <span class="o">=</span> <span class="n">data_clgP</span><span class="p">[</span><span class="n">data_clgP</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Mujeres</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">###########################################################</span>
<span class="c1"># Using &quot;sclP&quot;</span>
<span class="n">Tabla_hsgP</span> <span class="o">=</span> <span class="n">data_hsgP</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)[</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">nivel_hsgP</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_hsgP</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">Promedio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nivel</span> <span class="ow">in</span> <span class="n">nivel_hsgP</span><span class="p">:</span>
    <span class="n">Promedio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_hsgP</span><span class="p">[</span><span class="n">data_hsgP</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nivel</span><span class="p">][</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">Tabla_hsgP</span><span class="p">[</span><span class="s1">&#39;PromMovP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tabla_hsgP</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Repeat for &quot;clgP&quot;</span>
<span class="n">Tabla_clgP</span> <span class="o">=</span> <span class="n">data_clgP</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)[</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">Tabla_clgPf</span> <span class="o">=</span> <span class="n">data_clgPf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)[</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">Tabla_clgPm</span> <span class="o">=</span> <span class="n">data_clgPm</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;exp2&#39;</span><span class="p">)[</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">nivel_clgP</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data_clgP</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">Promedio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nivel</span> <span class="ow">in</span> <span class="n">nivel_clgP</span><span class="p">:</span>
    <span class="n">Promedio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_clgP</span><span class="p">[</span><span class="n">data_clgP</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nivel</span><span class="p">][</span><span class="s1">&#39;Predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">Tabla_clgP</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>
<span class="n">Tabla_clgPf</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promedio</span>

<span class="n">Promediof</span> <span class="o">=</span> <span class="n">Promedio</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Tabla_clgPm</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Promediof</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tabla_clgP</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Datos</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Tabla_clg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">x_3</span> <span class="o">=</span> <span class="n">Tabla_clgPm</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tabla_clg</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span>
<span class="n">y_3</span> <span class="o">=</span> <span class="n">Tabla_clgPm</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span>

<span class="c1"># Crear el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual CLG&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_3</span><span class="p">,</span> <span class="n">y_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Ajustes del gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years of Potential Experience&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log Wage (or Wage Gap)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Figure 10: Comparison between actual and fitted for CLG and HSG Male&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Marcas de los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Leyenda</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Datos</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Tabla_clg</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">x_3</span> <span class="o">=</span> <span class="n">Tabla_clgPf</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tabla_clg</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span>
<span class="n">y_3</span> <span class="o">=</span> <span class="n">Tabla_clgPf</span><span class="p">[</span><span class="s1">&#39;PromMov&#39;</span><span class="p">]</span>

<span class="c1"># Crear el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual CLG&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_3</span><span class="p">,</span> <span class="n">y_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Ajustes del gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Years of Potential Experience&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log Wage (or Wage Gap)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Figure 10: Comparison between actual and fitted for CLG and HSG Female&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Marcas de los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Leyenda</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Los patrones que se encuentran son que los salarios son mayores para las personas que asisten a la universidad que de los que asisten solo a la secundaria. Luego, la relacion de los anos de experiencia en el salario solo es positiva, tanto para universidad y secundaria, hasta antes de que se llegue a los 35 anos de experiencia. Luego, si diferenciamos entre sexo la diferencia es muy pequeña.</p>
<section id="now-we-will-construct-a-prediction-rule-for-log-hourly-wage-y-which-depends-linearly-on-job-relevant-characteristics-x">
<h3>Now, we will construct a prediction rule for (log) hourly wage <strong>Y</strong>, which depends linearly on job-relevant characteristics <strong>X</strong>:<a class="headerlink" href="#now-we-will-construct-a-prediction-rule-for-log-hourly-wage-y-which-depends-linearly-on-job-relevant-characteristics-x" title="Link to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[
Y = \beta'X + \epsilon
\]</div>
<p>Our goals are:</p>
<ul class="simple">
<li><p>Predict wages using various characteristics of workers.</p></li>
<li><p>Assess the predictive performance of a given model using the (adjusted) sample MSE, the (adjusted) sample <span class="math notranslate nohighlight">\(R^2\)</span> and the out-of-sample MSE and <span class="math notranslate nohighlight">\(R^2\)</span>.</p></li>
</ul>
<p>Toward answering the latter, we measure the prediction quality of the two models via data splitting:</p>
<ol class="arabic simple">
<li><p>Randomly split the data into one training sample and one testing sample. Here we just use a simple method (stratified splitting is a more sophisticated version of splitting that we might consider).</p></li>
<li><p>Use the training sample to estimate the parameters of the Basic Model and the Flexible Model.</p></li>
</ol>
<p>Before using the testing sample, we evaluate in-sample fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Load the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../data/wage2015_subsample_inference.csv&quot;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># Define alpha values for Lasso</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split data into training and test sets</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">)]</span>    <span class="c1"># training sample</span>
<span class="n">test</span> <span class="o">=</span>  <span class="n">data</span><span class="p">[</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span> <span class="p">]</span>   <span class="c1"># testing sample</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic model using OLS</span>
<span class="n">formula_basic</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + exp1 + shs + hsg+ scl + clg + mw + so + we + occ2+ ind2&#39;</span>
<span class="n">model_basic</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula_basic</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of regressors in the basic model:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_basic</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_basic</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model using OLS</span>
<span class="n">formula_flex</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + shs+hsg+scl+clg+occ2+ind2+mw+so+we + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>
<span class="n">model_flex</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula_flex</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of regressors in the flexible model:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_flex</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model using Lasso, in-sample fit</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;lwage&#39;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lasso_cv</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Results storage</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">lasso_cv</span><span class="o">.</span><span class="n">alphas_</span><span class="p">,</span>
    <span class="s1">&#39;mse&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lasso_cv</span><span class="o">.</span><span class="n">mse_path_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;lambda_min&#39;</span><span class="p">:</span> <span class="n">lasso_cv</span><span class="o">.</span><span class="n">alpha_</span><span class="p">,</span>
    <span class="s1">&#39;nzero&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lasso_cv</span><span class="o">.</span><span class="n">coef_</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display results</span>
<span class="n">results_sorted</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_sorted</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving optimal alpha</span>
<span class="n">alpha_opt</span><span class="o">=</span>  <span class="n">results_sorted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
<span class="n">alpha_opt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the results</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results_sorted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cross-validated MSE for each Alpha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-splitting-out-of-sample-performance">
<h3>Data Splitting: Out-of-sample performance<a class="headerlink" href="#data-splitting-out-of-sample-performance" title="Link to this heading">#</a></h3>
<p>Now that we have seen in-sample fit, we evaluate our models on the out-of-sample performance:</p>
<ol class="arabic simple">
<li><p>Use the testing sample for evaluation. Predict the <strong>wage</strong> of every observation in the testing sample based on the estimated parameters in the training sample.</p></li>
<li><p>Calculate the Mean Squared Prediction Error (<strong>MSE<sub>test</sub></strong>) based on the testing sample for both prediction models.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Out-of-sample performance</span>
<span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>   <span class="c1">#add constant </span>

<span class="n">lwage_pred</span> <span class="o">=</span>  <span class="n">model_basic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1"># predict out of sample</span>
<span class="c1">#print(lwage_pred)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MSE_test1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_test1</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_test1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the basic model: &quot;</span><span class="p">,</span> <span class="n">MSE_test1</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model</span>
<span class="c1"># estimating the parameters in the training sample</span>
<span class="n">flex_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula_flex</span>  <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">lwage_flex_pred</span> <span class="o">=</span>  <span class="n">flex_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1"># predict out of sample</span>
<span class="n">lwage_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">MSE_test2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_flex_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_test2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_test2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE_test2</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the flexible model: &quot;</span><span class="p">,</span> <span class="n">R2_test2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flexible model using lasso</span>
<span class="c1"># get exogenous variables from training data used in flex model</span>
<span class="n">flex_results_0</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula_flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">flex_results_0</span><span class="o">.</span><span class="n">exog</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Get endogenous variable </span>
<span class="n">lwage_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lwage_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model using Lasso</span>
<span class="c1"># get exogenous variables from testing data used in flex model</span>
<span class="n">flex_results_1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula_flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">flex_results_1</span><span class="o">.</span><span class="n">exog</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Get endogenous variable </span>
<span class="n">lwage_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lwage_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha_opt</span><span class="p">)</span>
<span class="n">lwage_lasso_fitted</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">lwage_train</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)</span>

<span class="n">MSE_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_lasso_fitted</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_lasso</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_lasso</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE_lasso</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the flexible model: &quot;</span><span class="p">,</span> <span class="n">R2_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print MSE and R^2</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_test1</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_test2</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_lasso</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_test1</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_test2</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_lasso</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$MSE_</span><span class="si">{test}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="s2">&quot;$R^2_</span><span class="si">{test}</span><span class="s2">$&quot;</span><span class="p">],</span> \
                      <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;basic reg&quot;</span><span class="p">,</span><span class="s2">&quot;flexible reg&quot;</span><span class="p">,</span><span class="s2">&quot;lasso regression&quot;</span><span class="p">])</span>
<span class="n">table2</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="frisch-waugh-lovell-fwl-theorem-proof">
<h1><strong>1.Frisch-Waugh-Lovell (FWL) Theorem Proof</strong><a class="headerlink" href="#frisch-waugh-lovell-fwl-theorem-proof" title="Link to this heading">#</a></h1>
<p>Given a linear regression model, we aim to demonstrate the FWL theorem using the following elements:</p>
<ul class="simple">
<li><p><strong><span class="math notranslate nohighlight">\(y\)</span></strong>: dependent variable vector (<span class="math notranslate nohighlight">\(n \times 1\)</span>)</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(D\)</span></strong>: matrix of independent variables of interest (<span class="math notranslate nohighlight">\(n \times k_1\)</span>)</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(\beta_1\)</span></strong>: coefficient vector for <span class="math notranslate nohighlight">\(D\)</span> (<span class="math notranslate nohighlight">\(k_1 \times 1\)</span>)</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(W\)</span></strong>: matrix of control variables (<span class="math notranslate nohighlight">\(n \times k_2\)</span>)</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(\beta_2\)</span></strong>: coefficient vector for <span class="math notranslate nohighlight">\(W\)</span> (<span class="math notranslate nohighlight">\(k_2 \times 1\)</span>)</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(u\)</span></strong>: error term vector (<span class="math notranslate nohighlight">\(n \times 1\)</span>)</p></li>
</ul>
<p>The model is represented as:</p>
<div class="math notranslate nohighlight">
\[ y = D\beta_1 + W\beta_2 + u\]</div>
<hr class="docutils" />
<section id="objective">
<h2><strong>Objective</strong><a class="headerlink" href="#objective" title="Link to this heading">#</a></h2>
<p>To prove that <span class="math notranslate nohighlight">\(\Psi = \beta_1\)</span> can be accurately estimated through the regression <span class="math notranslate nohighlight">\(e_y = e_D \Psi + \varepsilon\)</span>, employing the FWL theorem.</p>
</section>
<hr class="docutils" />
<section id="proof">
<h2><strong>Proof</strong><a class="headerlink" href="#proof" title="Link to this heading">#</a></h2>
<section id="step-1-control-for-variables-in-w">
<h3><strong>Step 1: Control for Variables in <span class="math notranslate nohighlight">\(W\)</span></strong><a class="headerlink" href="#step-1-control-for-variables-in-w" title="Link to this heading">#</a></h3>
<p>First, we calculate the residuals after controlling for <span class="math notranslate nohighlight">\(W\)</span>:</p>
<ul>
<li><p><strong>Regress <span class="math notranslate nohighlight">\(D\)</span> on <span class="math notranslate nohighlight">\(W\)</span>:</strong> Aim to determine the component of <span class="math notranslate nohighlight">\(D\)</span> that is orthogonal to <span class="math notranslate nohighlight">\(W\)</span>. This is achieved by calculating the residuals <span class="math notranslate nohighlight">\(e_D\)</span>, using the projection matrix:</p>
<div class="math notranslate nohighlight">
\[M_W = I - W(W'W)^{-1}W'\]</div>
<p>Thus, the residuals for <span class="math notranslate nohighlight">\(D\)</span> are:</p>
<div class="math notranslate nohighlight">
\[e_D = M_W D\]</div>
</li>
<li><p><strong>Regress <span class="math notranslate nohighlight">\(y\)</span> on <span class="math notranslate nohighlight">\(W\)</span>:</strong> Similarly, find the component of <span class="math notranslate nohighlight">\(y\)</span> not explained by <span class="math notranslate nohighlight">\(W\)</span>:</p>
<div class="math notranslate nohighlight">
\[e_y = M_W y\]</div>
</li>
</ul>
</section>
<section id="step-2-estimate-psi">
<h3><strong>Step 2: Estimate <span class="math notranslate nohighlight">\(\Psi\)</span></strong><a class="headerlink" href="#step-2-estimate-psi" title="Link to this heading">#</a></h3>
<p>With the residuals obtained, we proceed to estimate <span class="math notranslate nohighlight">\(\Psi\)</span>:</p>
<ul>
<li><p><strong>Regress <span class="math notranslate nohighlight">\(e_y\)</span> on <span class="math notranslate nohighlight">\(e_D\)</span> by OLS:</strong></p>
<div class="math notranslate nohighlight">
\[ e_y = e_D \Psi + z \]</div>
<p>Solving for <span class="math notranslate nohighlight">\(\Psi\)</span>, we get:</p>
<div class="math notranslate nohighlight">
\[ \hat{\Psi} = (e_D'e_D)^{-1}e_D'e_y \]</div>
<p>Substituting the expressions for residuals into <span class="math notranslate nohighlight">\(\hat{\Psi}\)</span> yields:</p>
<div class="math notranslate nohighlight">
\[ \hat{\Psi} = (D'M_W'M_W'D)^{-1}D'M_W'M_Wy \]</div>
<p>Which simplifies to:</p>
<div class="math notranslate nohighlight">
\[ \hat{\Psi} = (D'M_WD)^{-1}D'M_Wy \]</div>
</li>
</ul>
<p>And this proof that <span class="math notranslate nohighlight">\(\Psi = \beta_1\)</span>.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="conditional-expectation-function-minimizes-expected-squared-error-proof">
<h1><strong>2.Conditional Expectation Function Minimizes Expected Squared Error Proof</strong><a class="headerlink" href="#conditional-expectation-function-minimizes-expected-squared-error-proof" title="Link to this heading">#</a></h1>
<section id="problem-statement">
<h2><strong>Problem Statement</strong><a class="headerlink" href="#problem-statement" title="Link to this heading">#</a></h2>
<p>Given a random variable <span class="math notranslate nohighlight">\(Y\)</span> and a conditioning variable <span class="math notranslate nohighlight">\(X\)</span>, we consider a relationship of the form:
$<span class="math notranslate nohighlight">\( Y = m(X) + \epsilon \)</span>$
where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m(X) = E[Y | X]\)</span> is the Conditional Expectation Function (CEF) of <span class="math notranslate nohighlight">\(Y\)</span> given <span class="math notranslate nohighlight">\(X\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\epsilon\)</span> is the error term, representing the deviation of <span class="math notranslate nohighlight">\(Y\)</span> from its conditional mean.</p></li>
</ul>
</section>
<section id="id1">
<h2><strong>Objective</strong><a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Our goal is to prove that the function that minimizes the expected squared error:
$<span class="math notranslate nohighlight">\( m(X) = \text{arg}\min_{g(X)} E[(Y - g(X))^2] \)</span>$</p>
<p>is indeed:
$<span class="math notranslate nohighlight">\( E[(Y - g(X))^2] = E[\epsilon^2] \)</span>$</p>
</section>
<section id="id2">
<h2><strong>Proof</strong><a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<section id="step-1-expanding-the-expected-squared-error">
<h3><strong>Step 1: Expanding the Expected Squared Error</strong><a class="headerlink" href="#step-1-expanding-the-expected-squared-error" title="Link to this heading">#</a></h3>
<p>We start by expanding the expected squared difference as follows:
$<span class="math notranslate nohighlight">\( E[(Y - g(X))^2] = E[(Y - E[Y|X] + E[Y|X] - g(X))^2] \)</span>$</p>
<p>By applying the expansion for the square of a sum <span class="math notranslate nohighlight">\((a + b)^2 = a^2 + b^2 + 2ab\)</span>, where <span class="math notranslate nohighlight">\(a = Y - E[Y|X]\)</span> and <span class="math notranslate nohighlight">\(b = E[Y|X] - g(X)\)</span>, we obtain:
$<span class="math notranslate nohighlight">\( E[(Y - g(X))^2] = E[(Y - E[Y|X])^2] + E[(E[Y|X] - g(X))^2] + 2E[(Y - E[Y|X])(E[Y|X] - g(X))] \)</span>$</p>
</section>
<section id="step-2-simplifying-using-the-law-of-iterated-expectations">
<h3><strong>Step 2: Simplifying Using the Law of Iterated Expectations</strong><a class="headerlink" href="#step-2-simplifying-using-the-law-of-iterated-expectations" title="Link to this heading">#</a></h3>
<p>Applying the Law of Iterated Expectations to the mixed term:
$<span class="math notranslate nohighlight">\( 2E[(Y - E[Y|X])(E[Y|X] - g(X))] = 0 \)</span>$</p>
<p>This follows because the expectation of <span class="math notranslate nohighlight">\(Y - E[Y|X]\)</span> is zero by definition of the error term <span class="math notranslate nohighlight">\(\epsilon\)</span> (i.e., <span class="math notranslate nohighlight">\(Y - E[Y|X] = \epsilon\)</span> and <span class="math notranslate nohighlight">\(E[\epsilon] = 0\)</span>), and thus the cross-term disappears.</p>
</section>
<section id="step-3-final-reduction">
<h3><strong>Step 3: Final Reduction</strong><a class="headerlink" href="#step-3-final-reduction" title="Link to this heading">#</a></h3>
<p>After removing the cross-term, we are left with:
$<span class="math notranslate nohighlight">\( E[(Y - g(X))^2] = E[(Y - E[Y|X])^2] + E[(E[Y|X] - g(X))^2] \)</span>$</p>
<p>Since the second term <span class="math notranslate nohighlight">\(E[(E[Y|X] - g(X))^2]\)</span> is always non-negative, it follows that:
$<span class="math notranslate nohighlight">\( E[(Y - g(X))^2] \geq E[(Y - E[Y|X])^2] \)</span>$</p>
</section>
<section id="conclusion">
<h3><strong>Conclusion</strong><a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h3>
<p>The expected squared error is minimized when <span class="math notranslate nohighlight">\(g(X) = E[Y|X]\)</span>, demonstrating that the Conditional Expectation Function (CEF) <span class="math notranslate nohighlight">\(m(X)\)</span> minimizes the expected squared error:
$<span class="math notranslate nohighlight">\( m(X) = \text{arg}\min_{g(X)} E[(Y - g(X))^2] \)</span><span class="math notranslate nohighlight">\(
This conclusively proves that the CEF is the function that minimizes the expected squared error between the predicted values and the actual values of \)</span>Y$.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="group1_lab2_python.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Multicollinearity</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">An inferential problem: The Gender Wage Gap</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ols-regression-with-controls">Ols regression with controls</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialling-out-using-ols">Partialling-Out using ols</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-will-construct-a-prediction-rule-for-log-hourly-wage-y-which-depends-linearly-on-job-relevant-characteristics-x">Now, we will construct a prediction rule for (log) hourly wage <strong>Y</strong>, which depends linearly on job-relevant characteristics <strong>X</strong>:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting-out-of-sample-performance">Data Splitting: Out-of-sample performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#frisch-waugh-lovell-fwl-theorem-proof"><strong>1.Frisch-Waugh-Lovell (FWL) Theorem Proof</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objective"><strong>Objective</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proof"><strong>Proof</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-control-for-variables-in-w"><strong>Step 1: Control for Variables in <span class="math notranslate nohighlight">\(W\)</span></strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-estimate-psi"><strong>Step 2: Estimate <span class="math notranslate nohighlight">\(\Psi\)</span></strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-expectation-function-minimizes-expected-squared-error-proof"><strong>2.Conditional Expectation Function Minimizes Expected Squared Error Proof</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement"><strong>Problem Statement</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Objective</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Proof</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-expanding-the-expected-squared-error"><strong>Step 1: Expanding the Expected Squared Error</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-simplifying-using-the-law-of-iterated-expectations"><strong>Step 2: Simplifying Using the Law of Iterated Expectations</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-final-reduction"><strong>Step 3: Final Reduction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion"><strong>Conclusion</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Josue Maguiña
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>